# Анализ SHACL-инструментов для динамической генерации форм

**Дата:** 2025-12-31  
**Автор:** AI Assistant  
**Статус:** Анализ для принятия решения  
**Связанные документы:**
- `docs/project/project-docs.json` - документация проекта
- `docs/development/notes/docs-preliminary/25-1231-ontology-editing-workflow-selection.md` - выбор workflow

---

## Контекст

Проект FEONT использует:
- **Backend:** Spring Boot + Apache Jena (TDB2, Fuseki, SHACL)
- **Frontend:** Vue.js 3 + Quasar Framework
- **Формы:** @formkit/vue (указано в project-docs.json)
- **SHACL:** Используется для валидации, shapes хранятся в графе `urn:shacl:shapes`

**Задача:** Необходимо реализовать динамическую генерацию форм на основе SHACL shapes для редактирования данных в приложении.

**Рассматриваемые инструменты:**
1. **shacl-form** (HTML5 Web Component)
2. **Schímatos** (веб-приложение)
3. **SHAPEness** (инструмент с тремя представлениями)

---

## Текущее состояние проекта

### Использование SHACL

- ✅ SHACL shapes хранятся в Named Graph `urn:shacl:shapes`
- ✅ Apache Jena SHACL используется для валидации на backend
- ✅ Валидация результатов сохраняются в графе `urn:validation:results`
- ❌ Динамическая генерация форм из SHACL shapes не реализована

### Использование форм

- ✅ @formkit/vue указан как библиотека для форм в project-docs.json
- ⏳ Реализация динамических форм на основе SHACL планируется

---

## Анализ инструментов

### 1. shacl-form (HTML5 Web Component)

**Описание:**
- HTML5 Web Component для генерации форм из SHACL shapes
- Принимает на вход SHACL-описания и автоматически генерирует форму

**Преимущества:**
- ✅ Стандартный Web Component (может использоваться в любом фреймворке)
- ✅ Простая интеграция (достаточно подключить компонент)
- ✅ Автоматическая генерация форм из SHACL
- ✅ Не зависит от фреймворка (работает с Vue.js)

**Недостатки/Ограничения:**
- ⚠️ Требуется проверка актуальности и поддержки проекта
- ⚠️ Может потребоваться адаптация стилей под Quasar
- ⚠️ Ограниченная кастомизация (зависит от возможностей компонента)

**Совместимость с текущим стеком:**
- ✅ **Vue.js 3:** Web Components поддерживаются через встроенную интеграцию
- ✅ **Quasar:** Совместим, но может потребоваться стилизация
- ✅ **SHACL:** Прямая работа с SHACL shapes
- ✅ **Spring Boot:** Backend только предоставляет SHACL shapes через SPARQL

**Рекомендация:** ✅ **Подходит** для быстрого старта и простой интеграции

---

### 2. Schímatos

**Описание:**
- Веб-приложение с открытым исходным кодом для редактирования RDF-данных
- Автоматически строит формы из SHACL-описаний
- Позволяет редактировать как данные, так и структуру (формы) «на лету»

**Преимущества:**
- ✅ Полнофункциональное веб-приложение
- ✅ Редактирование и данных, и структуры форм
- ✅ Open source
- ✅ Автоматическая генерация форм из SHACL

**Недостатки/Ограничения:**
- ❌ **Самостоятельное приложение** (не компонент для интеграции)
- ❌ Требует отдельного развёртывания или iframe интеграции
- ⚠️ Может не соответствовать дизайну Quasar
- ⚠️ Интеграция в существующее приложение может быть сложной

**Совместимость с текущим стеком:**
- ⚠️ **Vue.js 3:** Schímatos - отдельное приложение, не Vue компонент
- ⚠️ **Quasar:** Не интегрируется напрямую, требует отдельного UI
- ✅ **SHACL:** Поддерживает SHACL shapes
- ✅ **Spring Boot:** Может работать через SPARQL endpoint

**Рекомендация:** ⚠️ **Частично подходит** - если нужен отдельный редактор, но не для интеграции в существующее приложение

---

### 3. SHAPEness

**Описание:**
- Инструмент с тремя представлениями: древовидное, графическое и табличное (формы)
- Позволяет одновременно видеть иерархию и редактировать конкретные поля

**Преимущества:**
- ✅ Три представления в одном интерфейсе
- ✅ Визуализация иерархии данных
- ✅ Редактирование через формы

**Недостатки/Ограничения:**
- ⚠️ Требуется проверка актуальности и доступности проекта
- ⚠️ Возможны проблемы с интеграцией в Vue.js приложение
- ⚠️ Может быть избыточным, если нужны только формы

**Совместимость с текущим стеком:**
- ⚠️ **Vue.js 3:** Требуется проверка способа интеграции
- ⚠️ **Quasar:** Совместимость неочевидна
- ✅ **SHACL:** Поддерживает SHACL
- ✅ **Spring Boot:** Может работать через SPARQL

**Рекомендация:** ⚠️ **Требуется дополнительное изучение** - проверить доступность и способ интеграции

---

## Сравнительный анализ

| Критерий | shacl-form | Schímatos | SHAPEness |
|----------|------------|-----------|-----------|
| **Тип решения** | Web Component | Веб-приложение | Инструмент |
| **Интеграция в Vue.js** | ✅ Легкая | ❌ Сложная | ⚠️ Требует проверки |
| **Совместимость с Quasar** | ✅ Хорошая | ❌ Не интегрируется | ⚠️ Неизвестно |
| **Простота использования** | ✅ Простая | ⚠️ Средняя | ⚠️ Средняя |
| **Кастомизация** | ⚠️ Ограниченная | ✅ Высокая | ⚠️ Зависит от инструмента |
| **Редактирование структуры** | ❌ Нет | ✅ Да | ⚠️ Зависит от инструмента |
| **Требует отдельного развёртывания** | ❌ Нет | ✅ Да | ⚠️ Возможно |

---

## Рекомендации для проекта FEONT

### Вариант 1: shacl-form (рекомендуется для быстрого старта)

**Подход:**
- Использовать shacl-form как Web Component внутри Vue.js приложения
- Интегрировать с Quasar компонентами для стилизации
- Получать SHACL shapes с backend через SPARQL endpoint

**Преимущества:**
- ✅ Быстрая интеграция
- ✅ Минимальные изменения в архитектуре
- ✅ Соответствует текущему стеку (Vue.js 3 + Quasar)

**Реализация:**
1. Добавить shacl-form компонент в проект
2. Создать Vue компонент-обёртку для shacl-form
3. Стилизовать под Quasar (при необходимости)
4. Интегрировать с SPARQL endpoint для получения SHACL shapes

---

### Вариант 2: Кастомное решение на основе @formkit/vue + SHACL парсер

**Подход:**
- Использовать уже указанный @formkit/vue
- Создать сервис для преобразования SHACL shapes в FormKit схему
- Генерировать формы динамически на основе SHACL

**Преимущества:**
- ✅ Полный контроль над функциональностью
- ✅ Использование уже выбранной библиотеки (@formkit/vue)
- ✅ Полная интеграция с Quasar
- ✅ Гибкость в кастомизации

**Недостатки:**
- ⚠️ Требует разработки парсера SHACL → FormKit schema
- ⚠️ Больше времени на реализацию

**Реализация:**
1. Создать сервис для парсинга SHACL shapes (frontend или backend)
2. Преобразовать SHACL в FormKit schema format
3. Использовать FormKit для рендеринга форм
4. Интегрировать с валидацией через Apache Jena SHACL (backend)

---

### Вариант 3: Гибридный подход (рекомендуется для долгосрочной перспективы)

**Подход:**
- Начать с shacl-form для быстрого прототипирования
- Параллельно разрабатывать кастомное решение на @formkit/vue
- Постепенно мигрировать на кастомное решение при необходимости

**Преимущества:**
- ✅ Быстрый старт с shacl-form
- ✅ Долгосрочная гибкость с кастомным решением
- ✅ Возможность сравнить оба подхода

---

## Рекомендация для текущего контекста

### В контексте workflow редактирования онтологии

**Текущая задача:** Реализация workflow для редактирования онтологии через Protege Desktop (файловый подход).

**Связь с динамической генерацией форм:**
- Динамическая генерация форм нужна для **редактирования данных** (экземпляров) в приложении
- Workflow редактирования онтологии нужен для **редактирования схемы** (классов, свойств)
- Это **дополняющие** функции, но не пересекающиеся напрямую

**Рекомендация:**
1. ✅ **shacl-form** подходит для быстрого старта динамической генерации форм
2. ✅ Можно реализовать параллельно с workflow редактирования онтологии
3. ✅ В будущем рассмотреть кастомное решение на @formkit/vue для большей гибкости

---

## Детальный план интеграции shacl-form

### Шаг 1: Изучение shacl-form

**Действия:**
- Проверить доступность и актуальность проекта
- Изучить документацию и примеры использования
- Проверить совместимость с Vue.js 3

**Ресурсы:**
- GitHub репозиторий shacl-form
- Документация и примеры

---

### Шаг 2: Интеграция в проект

**Действия:**
1. Установить/подключить shacl-form компонент
2. Создать Vue компонент-обёртку
3. Интегрировать с SPARQL endpoint для получения SHACL shapes
4. Стилизовать под Quasar (при необходимости)

**Файлы для создания/изменения:**
- `code/frontend/src/components/ShaclForm.vue` (новый компонент)
- `code/frontend/src/services/shacl.service.js` (сервис для работы с SHACL)
- Страницы, где нужны динамические формы

---

### Шаг 3: Backend поддержка

**Действия:**
1. Endpoint для получения SHACL shape по классу/URI
2. Опционально: endpoint для валидации данных через SHACL

**Файлы для изменения:**
- `code/backend/src/main/java/io/github/bondalen/feont/controller/ShaclController.java` (новый контроллер)
- `code/backend/src/main/java/io/github/bondalen/feont/service/ShaclService.java` (новый сервис)

---

### Шаг 4: Тестирование

**Действия:**
1. Создать тестовые SHACL shapes
2. Проверить генерацию форм для разных классов
3. Проверить валидацию данных
4. Проверить интеграцию с существующим UI

---

## Альтернатива: Кастомное решение на @formkit/vue

Если shacl-form не подходит или недостаточно гибкий:

### Архитектура решения

**Frontend:**
```javascript
// Сервис для преобразования SHACL → FormKit schema
shaclToFormKit(shaclShape) {
  // Парсинг SHACL shape
  // Извлечение свойств, типов, ограничений
  // Генерация FormKit schema
  return formKitSchema;
}
```

**Backend (опционально):**
```java
// Endpoint для преобразования SHACL → JSON Schema
@GetMapping("/shacl/to-json-schema")
public JSONSchema shaclToJsonSchema(@RequestParam String shapeUri) {
  // Загрузка SHACL shape
  // Преобразование в JSON Schema
  // Возврат схемы
}
```

**Преимущества:**
- Полная интеграция с Quasar
- Гибкость в кастомизации
- Использование уже выбранной библиотеки

**Недостатки:**
- Больше времени на разработку
- Необходимость реализации парсера SHACL

---

## Выводы и рекомендации

### Для текущего контекста (workflow редактирования онтологии)

**Рекомендация:** ✅ **shacl-form подходит** для динамической генерации форм

**Обоснование:**
1. Быстрая интеграция с Vue.js 3
2. Совместимость с Quasar
3. Прямая работа с SHACL shapes
4. Не конфликтует с workflow редактирования онтологии (разные задачи)

### Долгосрочная перспектива

**Рекомендация:** Рассмотреть кастомное решение на @formkit/vue для:
- Большей гибкости
- Полной интеграции с Quasar
- Использования уже выбранной библиотеки (@formkit/vue)

---

## Следующие шаги

1. **Изучить shacl-form:**
   - Проверить GitHub репозиторий
   - Изучить документацию
   - Создать простой прототип

2. **Создать план интеграции:**
   - Детализировать шаги интеграции
   - Определить необходимые изменения в коде
   - Оценить время на реализацию

3. **Принять решение:**
   - shacl-form для быстрого старта
   - Кастомное решение на @formkit/vue для долгосрочной перспективы
   - Гибридный подход

---

**Дата создания:** 2025-12-31  
**Статус:** Анализ завершён, требует проверки актуальности shacl-form

