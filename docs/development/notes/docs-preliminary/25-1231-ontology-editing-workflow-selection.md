# Выбор workflow для редактирования онтологии в FEONT

**Дата:** 2025-12-31  
**Автор:** AI Assistant  
**Статус:** Решение принято  
**Связанные документы:**
- `docs/project/project-docs.json` - документация проекта
- `docs/development/project-development.json` - планирование задач

---

## Контекст

Проект FEONT использует Apache Jena TDB2 для хранения RDF данных, включая онтологию в Named Graph `urn:ontology`. Возникла необходимость определить оптимальный способ редактирования онтологии с использованием внешних инструментов (Protege и альтернативы).

**Проблема:** TDB2 хранит данные в бинарном формате, что делает невозможным прямое редактирование файлов. Требовалось найти способ работы с онтологией, который:
1. Обеспечивает полнофункциональное редактирование
2. Избегает дублирования данных
3. Подходит для работы в небольших командах
4. Соответствует открытым стандартам и инструментам

---

## Рассмотренные варианты

### Вариант 1: Прямое подключение Protege к SPARQL endpoint

**Описание:** Использование Protege Desktop для подключения к SPARQL endpoint через SPARQL Query tab.

**Изучение возможностей:**
- Protege Desktop имеет SPARQL Query tab для выполнения запросов
- Может выполнять SELECT, CONSTRUCT, ASK, DESCRIBE запросы
- НЕ поддерживает прямое редактирование через endpoint
- Требует загрузки онтологии в память для редактирования

**Результат:** ❌ Не решает проблему - редактирование всё равно требует загрузки данных в память Protege, что создаёт дублирование.

---

### Вариант 2: Замена TDB2 на другое хранилище

**Описание:** Рассмотрение альтернативных RDF хранилищ, которые поддерживают прямое редактирование через сетевые протоколы.

**Изученные варианты:**

#### 2.1. RDF4J Server
- Open source, активно развивается
- Веб-интерфейс (RDF4J Workbench) для редактирования
- Прямая работа с данными через Repository API
- **Проблема:** Требует замены всего хранилища, изменения API (с Jena на RDF4J)

#### 2.2. GraphDB Free
- Веб-интерфейс для редактирования (Workbench)
- Прямая работа с данными в GraphDB
- **Проблема:** Коммерческий продукт (free edition с ограничениями), требует замены хранилища

#### 2.3. Apache Jena SDB (реляционная БД)
- Хранение RDF в MySQL/PostgreSQL
- Совместимость с Jena API (минимальные изменения)
- **Проблема:** Меньшая производительность для RDF, не решает проблему прямого редактирования

**Результат:** ❌ Замена хранилища не решает проблему - Protege всё равно не может редактировать напрямую через endpoint, независимо от хранилища.

---

### Вариант 3: Использование альтернатив Protege

**Описание:** Рассмотрение альтернативных редакторов онтологий, которые поддерживают прямое редактирование через SPARQL endpoint.

**Изученные варианты:**

#### 3.1. VocBench
- Open source веб-редактор онтологий
- Поддерживает прямое подключение к SPARQL endpoint
- Прямое редактирование через SPARQL Update
- **Преимущества:** 
  - Решает проблему дублирования данных
  - Коллаборативная работа
  - Веб-интерфейс
- **Недостатки:**
  - Функциональность UI ~50-60% от Protege для OWL
  - Ограниченная поддержка сложных OWL 2 DL конструкций
  - Отсутствует reasoning (логический вывод)
  - Ограниченная экосистема плагинов (~10-20% от Protege)

#### 3.2. WebProtege
- Веб-версия Protege
- Совместная работа
- **Проблема:** Не поддерживает прямое подключение к SPARQL endpoint, работает с собственным форматом проектов

#### 3.3. TopBraid Composer
- Коммерческий редактор с богатым функционалом
- Поддерживает различные хранилища
- **Проблема:** Коммерческий продукт, требует лицензирования

**Результат:** ⚠️ VocBench решает проблему дублирования, но функциональность значительно уступает Protege Desktop для работы с OWL онтологиями.

---

### Вариант 4: Работа через сетевые протоколы (SMB/WebDAV)

**Описание:** Экспорт онтологии в RDF файл, размещение на сетевом диске (SMB/WebDAV), редактирование в Protege.

**Изучение возможностей:**
- Protege может открывать файлы через HTTP URL (`File → Open from URL`)
- Protege может открывать файлы с сетевых дисков (SMB/CIFS)
- Изменения сохраняются в файл
- **Проблема:** Требуется синхронизация файл → TDB2 после редактирования

**Результат:** ⚠️ Частично решает проблему, но требует механизма синхронизации файл → TDB2, что усложняет процесс.

---

### Вариант 5: Файловый workflow (выбранное решение)

**Описание:** Экспорт онтологии в файл → редактирование в Protege Desktop → импорт файла обратно в приложение.

**Процесс:**
1. Экспорт онтологии из приложения в файл (Turtle/RDF формат)
2. Приостановка работы приложения на период редактирования (для избежания конфликтов)
3. Бэкап данных TDB2
4. Редактирование файла в Protege Desktop
5. Импорт изменённого файла обратно в приложение
6. Возобновление работы приложения

**Преимущества:**
- ✅ Использование полного функционала Protege Desktop (самый мощный open source редактор)
- ✅ Нет проблем с синхронизацией (приостановка работы на период редактирования)
- ✅ Простой и надёжный процесс
- ✅ Полный контроль над процессом
- ✅ Подходит для небольших команд
- ✅ Бэкап через копирование файлов TDB2

**Недостатки:**
- ⚠️ Требует приостановки работы приложения (приемлемо для небольших команд)
- ⚠️ Ручное управление процессом (можно автоматизировать через скрипты)

**Результат:** ✅ **ПРИНЯТО К РЕАЛИЗАЦИИ**

---

## Сравнительный анализ редакторов онтологий

### Функциональность UI (из коробки)

**Рейтинг по функциональности:**

1. **TopBraid Composer** — ~95-100%
   - Коммерческий продукт
   - Богатый функционал из коробки

2. **Protege Desktop** — ~90-95% (open source лидер)
   - Самый широкий функционал среди open source
   - 120+ плагинов для расширения
   - Полная поддержка OWL 2 DL
   - Reasoning интеграция

3. **OntoStudio** — ~85-90%
   - Коммерческий продукт

4. **VocBench** — ~50-60%
   - Open source
   - Ограниченный функционал для OWL
   - Специализация на SKOS/тезаурусах

5. **WebProtege** — ~50-55%
   - Упрощённая версия Protege

6. **Fluent Editor** — ~30-40%
   - CNL подход (не визуальный редактор)

**Вывод:** Protege Desktop предлагает самый широкий функционал "из коробки" среди open source редакторов, особенно для работы с OWL онтологиями.

---

## Принятое решение

### Выбранный вариант: Файловый workflow с Protege Desktop

**Минимальный вариант (первая реализация):**
1. Endpoint `/ds/ontology` для экспорта онтологии (Turtle формат)
2. Endpoint `/ds/ontology/import` для импорта файла онтологии
3. Ручная остановка приложения на период редактирования
4. Ручной бэкап через копирование директории TDB2

**Улучшенный вариант (вторая реализация):**
1. Все из минимального варианта
2. Механизм блокировки редактирования онтологии (без остановки приложения)
3. Валидация загружаемой онтологии
4. Сохранение предыдущей версии в `urn:ontology:history` (опционально)
5. Скрипты для автоматизации процесса (опционально)

---

## Обоснование выбора

### Почему файловый workflow, а не VocBench?

1. **Функциональность:** Protege Desktop предлагает ~90-95% функциональности UI, VocBench только ~50-60%
2. **OWL 2 DL поддержка:** Protege имеет полную поддержку сложных OWL конструкций, VocBench ограничен
3. **Reasoning:** Protege интегрируется с резонерами (HermiT, FaCT), VocBench не поддерживает
4. **Плагины:** Protege имеет экосистему 120+ плагинов, VocBench очень ограничен
5. **Удобство:** Файловый workflow прост и понятен, контроль над процессом

### Почему приостановка работы приемлема?

1. **Небольшие команды:** В составе небольших команд конфликты редки
2. **Периодичность:** Редактирование онтологии происходит нечасто
3. **Контроль:** Полный контроль над процессом, отсутствие скрытых конфликтов
4. **Простота:** Простой и надёжный процесс без сложной синхронизации

### Почему не замена хранилища?

1. **Стабильность:** TDB2 уже интегрирован и работает
2. **Совместимость:** Jena API используется во всём приложении
3. **Производительность:** TDB2 оптимизирован для RDF данных
4. **Не решает проблему:** Замена хранилища не решает проблему прямого редактирования в Protege

---

## Требования к реализации

### Минимальный вариант

**Что нужно добавить:**
1. Endpoint `GET /ds/ontology` — экспорт онтологии в формате Turtle
2. Endpoint `POST /ds/ontology/import` — импорт файла онтологии
   - Приём файла (multipart/form-data)
   - Парсинг Turtle/RDF/XML
   - Замена содержимого графа `urn:ontology`
3. Документация workflow для пользователей

**Текущее состояние:**
- ✅ Endpoint `/ds/data?graph=urn:ontology&format=turtle` уже существует (можно использовать)
- ✅ SPARQL Update работает (для будущего улучшения)
- ❌ Endpoint для импорта файла отсутствует

### Улучшенный вариант

**Дополнительно к минимальному:**
1. Механизм блокировки редактирования онтологии
   - Endpoint `POST /ds/ontology/lock`
   - Endpoint `POST /ds/ontology/unlock`
   - Проверка блокировки перед операциями Update онтологии
2. Валидация загружаемой онтологии
   - Синтаксическая валидация RDF (обязательно)
   - Валидация OWL (опционально)
3. Сохранение истории изменений (опционально)
   - Сохранение предыдущей версии в `urn:ontology:history` перед импортом
4. Скрипты для автоматизации (опционально)
   - `scripts/export-ontology.sh`
   - `scripts/import-ontology.sh`
   - `scripts/backup-tdb2.sh`

---

## Workflow процесса (детальный)

### Фаза 1: Подготовка

1. Экспорт онтологии: `GET /ds/ontology` → сохранить файл
2. Блокировка (улучшенный вариант): `POST /ds/ontology/lock`
   - Или остановка приложения (минимальный вариант): `systemctl stop feont`
3. Бэкап: `cp -r data/tdb2 data/tdb2-backup-YYYYMMDD-HHMMSS`

### Фаза 2: Редактирование

1. Открыть файл в Protege Desktop: `File → Open`
2. Редактировать онтологию
3. Сохранить изменения в файл

### Фаза 3: Импорт

1. Загрузить файл: `POST /ds/ontology/import` (с файлом)
2. Проверка результата
3. Разблокировка (улучшенный вариант): `POST /ds/ontology/unlock`
   - Или запуск приложения (минимальный вариант): `systemctl start feont`

### Фаза 4: Проверка

1. Проверка в веб-интерфейсе приложения
2. Выполнение тестовых SPARQL запросов
3. Валидация данных (опционально)

---

## Следующие шаги

1. Реализация минимального варианта
   - Создание endpoint для импорта
   - Документирование workflow
2. Тестирование workflow
   - Проверка экспорта/импорта
   - Проверка целостности данных
3. Реализация улучшенного варианта
   - Добавление механизма блокировки
   - Добавление валидации
4. Создание скриптов автоматизации (опционально)

---

## Связанные документы

- `docs/project/project-docs.json` - документация проекта
- `docs/development/project-development.json` - планирование задач
- `docs/development/notes/chats/chat-plan/chat-plan-25-1231-ontology-workflow-implementation.md` - план реализации

---

## Примечания

- Решение основано на анализе возможностей существующих инструментов
- Файловый workflow выбран как баланс между функциональностью и простотой
- Для больших команд с частым редактированием можно рассмотреть улучшенный вариант с блокировкой
- В будущем можно рассмотреть интеграцию с VocBench для веб-редактирования (при необходимости)

---

**Дата создания:** 2025-12-31  
**Статус:** Решение принято, готово к реализации

