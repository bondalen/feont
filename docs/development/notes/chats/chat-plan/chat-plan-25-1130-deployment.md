**Дата:** 2025-11-30  
**Автор:** Александр  
**Связанные задачи:** (будут созданы в project-development.json)  
**Связанное предложение:** [25-1130-documentation-system-proposal.md](../../docs-preliminary/25-1130-documentation-system-proposal.md)

## Контекст

Проект FEONT находится на стадии планирования. Документация создана, необходимо спланировать разработку и развёртывание приложения на удалённой виртуальной машине (176.108.244.252).

**Требования к развёртыванию:**
- Минимизация потребляемых ресурсов
- Разделение данных и приложения (данные сохраняются при обновлении)
- Единый JAR-файл для всего приложения (Fuseki + Frontend)
- Минимальный контейнер для данных TDB2 (или данные без контейнера)

**Цель:** Создать план разработки приложения FEONT с учётом оптимальной архитектуры развёртывания: единый Spring Boot JAR с встроенным Fuseki и frontend, отдельное хранилище данных TDB2.

**Именование Java:**
- Корневой пакет: `io.github.bondalen.feont`
- Репозиторий: `bondalen/feont`
- Формат: `io.github.{owner}.{repository}`

---

## Структурный план (№ 01)

- ✅ 01.0 Этап 1 ― Подготовка структуры проекта и конфигурации
  - ✅ 01.1 Создать структуру каталогов для кода
    - ✅ 01.1.1 Создать `code/backend/` для Spring Boot приложения
      - Структура Maven проекта
      - Базовые каталоги: `src/main/java/`, `src/main/resources/`
    - ✅ 01.1.2 Создать `code/frontend/` для Vue.js 3 + Quasar
      - Структура Quasar проекта
      - Конфигурация для сборки в статику
    - ✅ 01.1.3 Создать `code/docker/` для конфигураций (опционально)
      - docker-compose.yml для минимального контейнера данных (если нужен)
      - Конфигурационные файлы
  - ✅ 01.2 Настроить build системы
    - ✅ 01.2.1 Создать Maven конфигурацию для backend
      - pom.xml создан
      - Зависимости: Spring Boot, Apache Jena Fuseki, TDB2, SHACL
      - Настроен package name: `io.github.bondalen.feont`
    - ✅ 01.2.2 Настроить сборку frontend
      - package.json для Vue.js/Quasar создан
      - Скрипт сборки создан (scripts/build.sh), который копирует результат в backend/resources/static
      - Конфигурация окружения для production настроена

- ⏳ 02.0 Этап 2 ― Разработка Backend (Spring Boot + встроенный Fuseki)
  - ⏳ 02.1 Создать базовую структуру Spring Boot приложения
    - ⏳ 02.1.1 Создать главный класс приложения
      - `io.github.bondalen.feont.FeontApplication`
      - Аннотации Spring Boot
      - Точка входа
    - ⏳ 02.1.2 Настроить application.yml/properties
      - Порт приложения (8083)
      - Путь к TDB2 хранилищу (конфигурируемый)
      - Настройки Fuseki
  - ⏳ 02.2 Интегрировать Apache Jena Fuseki
    - ⏳ 02.2.1 Создать конфигурационный класс Fuseki
      - `io.github.bondalen.feont.config.FusekiConfig`
      - Инициализация встроенного Fuseki сервера
      - Подключение к TDB2 по указанному пути
    - ⏳ 02.2.2 Настроить dataset и Named Graphs
      - Создание dataset "ds"
      - Инициализация Named Graphs: urn:ontology, urn:data, urn:shacl:shapes, urn:ontology:history, urn:validation:results
    - ⏳ 02.2.3 Настроить SPARQL endpoints
      - /sparql (query)
      - /update (SPARQL Update)
      - /data (data access)
  - ⏳ 02.3 Настроить встраивание frontend статики
    - ⏳ 02.3.1 Настроить Spring Boot для раздачи статики
      - Конфигурация StaticResourceHandler
      - Fallback на index.html для SPA
    - ⏳ 02.3.2 Создать build скрипт для копирования frontend
      - Автоматическое копирование из frontend/dist в resources/static
      - Интеграция в Maven/Gradle build процесс

- ⏳ 03.0 Этап 3 ― Разработка Frontend (Vue.js 3 + Quasar)
  - ⏳ 03.1 Инициализация Quasar проекта
    - ⏳ 03.1.1 Создать Quasar проект
      - quasar create
      - Настройка структуры
    - ⏳ 03.1.2 Настроить зависимости
      - Vue.js 3, Quasar Framework
      - Библиотеки: Cytoscape.js, rdflib.js, n3, jsonld
      - @formkit/vue для форм
  - ⏳ 03.2 Интеграция библиотек для работы с RDF
    - ⏳ 03.2.1 Настроить подключение к SPARQL endpoint
      - Конфигурация endpoint URL (из переменных окружения)
      - Базовые утилиты для SPARQL запросов
    - ⏳ 03.2.2 Настроить визуализацию графов
      - Cytoscape.js для интерактивных графов данных
      - WebVOWL для визуализации онтологии (опционально)
  - ⏳ 03.3 Реализация базовых компонентов
    - ⏳ 03.3.1 Создать компоненты для работы с SPARQL
      - YASGUI интеграция для SPARQL запросов
      - Компоненты для отображения результатов
    - ⏳ 03.3.2 Создать компоненты для визуализации
      - Компонент графа знаний (Cytoscape.js)
      - Компонент онтологии (WebVOWL, опционально)

- ⏳ 04.0 Этап 4 ― Конфигурация развёртывания на сервере
  - ⏳ 04.1 Подготовка сервера (176.108.244.252)
    - ⏳ 04.1.1 Создать структуру каталогов на сервере
      - `/home/user1/feont/` - основной каталог
      - `/home/user1/feont/data/tdb2/` - хранилище TDB2
      - Настроить права доступа
    - ⏳ 04.1.2 Проверить/установить Java 21 (уже установлен)
      - Проверка версии
      - Настройка переменных окружения при необходимости
  - ⏳ 04.2 Настройка хранения данных (вариант без контейнера)
    - ⏳ 04.2.1 Создать директорию для TDB2
      - `/home/user1/feont/data/tdb2/`
      - Настроить права: `chown user1:user1`
    - ⏳ 04.2.2 Документировать путь для конфигурации
      - Указать в application.yml путь по умолчанию
      - Возможность переопределения через переменные окружения
  - ⏳ 04.3 Настройка systemd service
    - ⏳ 04.3.1 Создать service файл
      - `/etc/systemd/system/feont.service`
      - Настройка запуска JAR файла
      - Переменные окружения (путь к TDB2)
    - ⏳ 04.3.2 Настроить автозапуск
      - `systemctl enable feont`
      - Тестирование запуска/остановки
  - ⏳ 04.4 Настройка Nginx reverse proxy
    - ⏳ 04.4.1 Создать конфигурацию Nginx
      - `/etc/nginx/sites-available/feont`
      - Настройка proxy на порт 8083
      - Обработка статики и SPARQL endpoints
    - ⏳ 04.4.2 Настроить SSL (если требуется)
      - Использование существующих сертификатов ontoline.ru
      - Или настройка поддомена feont.ontoline.ru
    - ⏳ 04.4.3 Активировать конфигурацию
      - Создать символическую ссылку в sites-enabled
      - Проверка конфигурации: `nginx -t`
      - Перезагрузка: `systemctl reload nginx`

- ⏳ 05.0 Этап 5 ― Сборка и развёртывание
  - ⏳ 05.1 Локальная сборка
    - ⏳ 05.1.1 Собрать frontend
      - `npm run build` или `quasar build`
      - Проверка результата в `frontend/dist/`
    - ⏳ 05.1.2 Скопировать frontend в backend
      - Автоматически через build скрипт или вручную
      - Проверка наличия файлов в `backend/src/main/resources/static/`
    - ⏳ 05.1.3 Собрать JAR файл
      - `mvn clean package` или `./gradlew build`
      - Проверка размера JAR (ожидается ~50-100MB)
      - Проверка наличия всех зависимостей
  - ⏳ 05.2 Тестирование локально
    - ⏳ 05.2.1 Запустить JAR локально
      - `java -jar feont-1.0.0.jar --spring.datasource.tdb2.path=./data/tdb2`
      - Проверка доступности на порту 8083
      - Проверка SPARQL endpoint
      - Проверка frontend статики
    - ⏳ 05.2.2 Протестировать базовый функционал
      - Выполнение SPARQL запросов
      - Проверка работы Named Graphs
      - Проверка frontend интерфейса
  - ⏳ 05.3 Развёртывание на сервере
    - ⏳ 05.3.1 Скопировать JAR на сервер
      - `scp feont-1.0.0.jar user1@176.108.244.252:/home/user1/feont/`
    - ⏳ 05.3.2 Запустить приложение
      - Первый запуск через systemd: `systemctl start feont`
      - Проверка статуса: `systemctl status feont`
      - Проверка логов: `journalctl -u feont -f`
    - ⏳ 05.3.3 Проверить работу
      - Проверка доступности через Nginx
      - Тестирование SPARQL endpoint
      - Проверка frontend интерфейса

- ⏳ 06.0 Этап 6 ― Документация и финализация
  - ⏳ 06.1 Обновить документацию проекта
    - ⏳ 06.1.1 Обновить project-docs.json
      - Добавить информацию о развёртывании
      - Обновить секцию infrastructure.deployment
    - ⏳ 06.1.2 Создать документацию по развёртыванию
      - Инструкции по сборке
      - Инструкции по развёртыванию на сервере
      - Описание процесса обновления
  - ⏳ 06.2 Создать скрипты для автоматизации
    - ⏳ 06.2.1 Скрипт сборки
      - `scripts/build.sh` - полная сборка проекта
    - ⏳ 06.2.2 Скрипт развёртывания
      - `scripts/deploy.sh` - копирование и обновление на сервере
    - ⏳ 06.2.3 Скрипт обновления
      - `scripts/update.sh` - процесс обновления приложения

---

## Контрольные точки

- K1 ― Структура проекта создана, build системы настроены (закрывает блок 01.0) — ✅ выполнено
  - Критерии: структура каталогов создана, Maven и npm конфигурации созданы, package name установлен как `io.github.bondalen.feont`

- K2 ― Backend приложение создано, Fuseki интегрирован (закрывает блок 02.0) — ⏳ планируется
  - Критерии: Spring Boot приложение запускается, Fuseki работает, SPARQL endpoints доступны, frontend статика встраивается

- K3 ― Frontend приложение создано и интегрирован (закрывает блок 03.0) — ⏳ планируется
  - Критерии: Quasar проект создан, библиотеки для RDF подключены, базовые компоненты работают, сборка в статику работает

- K4 ― Сервер настроен, приложение развёрнуто (закрывает блок 04.0, 05.0) — ⏳ планируется
  - Критерии: каталоги созданы, systemd service работает, Nginx настроен, приложение доступно через веб, SPARQL работает

- K5 ― Документация обновлена, скрипты созданы (закрывает блок 06.0) — ⏳ планируется
  - Критерии: документация актуальна, скрипты работают, процесс обновления задокументирован

---

## Статус плана

- ✅ **Этап 1 (01.0)** — выполнен
  - ✅ Создание структуры проекта (01.1) — выполнено
  - ✅ Настройка build систем (01.2) — выполнено
- ⏳ **Этап 2 (02.0)** — планируется
  - ⏳ Разработка Backend (02.1, 02.2, 02.3) — планируется
- ⏳ **Этап 3 (03.0)** — планируется
  - ⏳ Разработка Frontend (03.1, 03.2, 03.3) — планируется
- ⏳ **Этап 4 (04.0)** — планируется
  - ⏳ Конфигурация сервера (04.1, 04.2, 04.3, 04.4) — планируется
- ⏳ **Этап 5 (05.0)** — планируется
  - ⏳ Сборка и развёртывание (05.1, 05.2, 05.3) — планируется
- ⏳ **Этап 6 (06.0)** — планируется
  - ⏳ Документация и финализация (06.1, 06.2) — планируется

---

## Предложения по следующим шагам

**Следующие шаги после завершения плана:**
1. Начать с Этапа 1 - создание структуры проекта и настройка build систем
2. Определить приоритеты: начать с backend или frontend (рекомендуется backend для быстрого получения работающего SPARQL endpoint)
3. Разработать минимальный функционал для первого развёртывания
4. Постепенно добавлять функциональность после успешного развёртывания базовой версии

**Рекомендации:**
- Начать с минимально рабочей версии: только Fuseki + базовый frontend
- Добавлять визуализацию и сложные компоненты после базового развёртывания
- Тестировать сборку на каждом этапе
- Документировать процесс для последующих обновлений

---

## Именование Java пакетов

**Формат:** `io.github.{owner}.{repository}`

**Для проекта FEONT:**
- **Репозиторий:** `bondalen/feont`
- **Owner:** `bondalen`
- **Repository:** `feont`
- **Корневой пакет:** `io.github.bondalen.feont`

**Структура пакетов:**
```
io.github.bondalen.feont
├── FeontApplication.java              # Главный класс
├── config/
│   ├── FusekiConfig.java              # Конфигурация Fuseki
│   └── WebConfig.java                 # Конфигурация веб
├── controller/
│   └── SparqlController.java          # REST контроллеры
├── service/
│   ├── SparqlService.java             # Сервисы для SPARQL
│   └── Tdb2Service.java               # Работа с TDB2
└── model/                             # Модели данных (если нужны)
```

**Maven groupId/artifactId:**
- **groupId:** `io.github.bondalen.feont`
- **artifactId:** `feont`
- **version:** `1.0.0-SNAPSHOT` (для разработки) / `1.0.0` (для релиза)

**Пример pom.xml:**
```xml
<groupId>io.github.bondalen.feont</groupId>
<artifactId>feont</artifactId>
<version>1.0.0-SNAPSHOT</version>
<packaging>jar</packaging>
<name>FEONT</name>
<description>Приложение для работы с графом знаний</description>
```

---

## Связанные документы

- [project-docs.json](../../../project/project-docs.json) - документация проекта
- [project-development.json](../../project-development.json) - планирование задач
- [docker-config.json](../../../project/extensions/deployment/docker-config.json) - конфигурация Docker
- [fuseki-config.json](../../../project/extensions/deployment/fuseki-config.json) - конфигурация Fuseki

---

## Примечания

**Архитектурные решения:**
- Используется вариант без контейнера для данных (максимальная экономия ресурсов)
- TDB2 хранилище на хосте: `/home/user1/feont/data/tdb2/`
- Единый JAR включает: Spring Boot + встроенный Fuseki + frontend статика
- Порты: 8083 для приложения, Nginx проксирует на 8083

**Важные замечания:**
- Путь к TDB2 должен быть конфигурируемым через application.yml и переменные окружения
- При обновлении JAR данные в `/home/user1/feont/data/tdb2/` сохраняются
- Frontend должен быть собран перед сборкой JAR
- Проверять совместимость версий Apache Jena при обновлении

**Процесс обновления:**
1. Остановить приложение: `systemctl stop feont`
2. Скопировать новый JAR: `cp feont-1.1.0.jar /home/user1/feont/feont-1.0.0.jar`
3. Запустить приложение: `systemctl start feont`
4. Данные остаются в `/home/user1/feont/data/tdb2/`

